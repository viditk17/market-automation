<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Market Automation ‚Äî Work Assignment Summary</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Mono:wght@300;400;500&family=Outfit:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<style>
:root{--bg-deep:#0a0c10;--bg-card:#12151c;--bg-card-hover:#181c26;--bg-elevated:#1a1e28;--border:#1e2433;--border-active:#2d3548;--text-primary:#e8eaf0;--text-secondary:#7a8299;--text-muted:#4a5166;--accent-amber:#f0a830;--accent-amber-dim:#f0a83020;--accent-green:#34d399;--accent-green-dim:#34d39915;--accent-blue:#60a5fa;--accent-blue-dim:#60a5fa15;--accent-red:#f87171;--accent-red-dim:#f8717115;--accent-purple:#a78bfa;--accent-purple-dim:#a78bfa15;--radius:12px;--radius-sm:8px;--radius-lg:20px;--font-display:'Outfit',sans-serif;--font-mono:'DM Mono',monospace}
*{margin:0;padding:0;box-sizing:border-box}
body{background:var(--bg-deep);color:var(--text-primary);font-family:var(--font-display);min-height:100vh;overflow-x:hidden}
body::before{content:'';position:fixed;inset:0;background:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.03'/%3E%3C/svg%3E");pointer-events:none;z-index:9999}
.ambient-glow{position:fixed;width:600px;height:600px;border-radius:50%;filter:blur(150px);opacity:.07;pointer-events:none;z-index:0}
.glow-1{top:-200px;left:-100px;background:var(--accent-amber)}.glow-2{bottom:-200px;right:-100px;background:var(--accent-blue)}
.container{max-width:1280px;margin:0 auto;padding:0 32px;position:relative;z-index:1}
nav{padding:20px 0;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--border);animation:fadeDown .6s ease}
.nav-brand{display:flex;align-items:center;gap:12px}
.nav-logo{width:40px;height:40px;background:linear-gradient(135deg,var(--accent-amber),#e08a10);border-radius:10px;display:grid;place-items:center;font-family:var(--font-mono);font-weight:500;font-size:16px;color:#000}
.nav-title{font-size:15px;font-weight:600}.nav-title span{color:var(--text-muted);font-weight:400}
.tab-switcher{display:flex;gap:4px;background:var(--bg-card);border:1px solid var(--border);border-radius:10px;padding:4px}
.tab-btn{padding:10px 24px;border-radius:8px;font-family:var(--font-display);font-size:13px;font-weight:600;border:none;cursor:pointer;background:transparent;color:var(--text-muted);transition:all .25s}
.tab-btn:hover{color:var(--text-secondary)}.tab-btn.active{background:var(--accent-amber);color:#000;box-shadow:0 2px 12px #f0a83040}
.tab-content{display:none}.tab-content.active{display:block}
.hero{padding:80px 0 60px;text-align:center}
.hero-badge{display:inline-flex;align-items:center;gap:8px;font-family:var(--font-mono);font-size:11px;letter-spacing:1.5px;text-transform:uppercase;color:var(--accent-amber);background:var(--accent-amber-dim);border:1px solid #f0a83020;padding:8px 18px;border-radius:100px;margin-bottom:28px;animation:fadeUp .5s ease .1s both}
.hero h1{font-size:clamp(42px,6vw,72px);font-weight:900;line-height:1.05;letter-spacing:-2.5px;margin-bottom:20px;animation:fadeUp .6s ease .2s both}
.hero h1 .highlight{background:linear-gradient(135deg,var(--accent-amber),#ffcc60);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.hero p{font-size:18px;color:var(--text-secondary);max-width:580px;margin:0 auto 40px;line-height:1.65;font-weight:300;animation:fadeUp .6s ease .3s both}
.section{padding:60px 0}.section-label{font-family:var(--font-mono);font-size:11px;letter-spacing:2px;text-transform:uppercase;color:var(--text-muted);margin-bottom:12px}
.section-title{font-size:32px;font-weight:700;letter-spacing:-1px;margin-bottom:48px}
.stats-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:16px;margin-bottom:48px}
.stat-card{background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius);padding:24px;transition:all .25s;position:relative;overflow:hidden}
.stat-card::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:var(--card-accent,var(--accent-amber));opacity:0;transition:opacity .25s}
.stat-card:hover{border-color:var(--border-active);transform:translateY(-2px)}.stat-card:hover::before{opacity:1}
.stat-label{font-size:12px;font-family:var(--font-mono);color:var(--text-muted);letter-spacing:.5px;text-transform:uppercase;margin-bottom:10px}
.stat-value{font-size:36px;font-weight:800;letter-spacing:-1.5px;line-height:1;margin-bottom:6px}
.stat-desc{font-size:12px;color:var(--text-secondary);font-weight:300}
.arch-flow{display:flex;align-items:center;justify-content:center;gap:0;padding:40px 0;flex-wrap:wrap}
.arch-node{background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius);padding:18px 24px;text-align:center;min-width:140px;transition:all .25s}
.arch-node:hover{border-color:var(--accent-amber);transform:translateY(-2px)}
.arch-node h5{font-size:12px;font-weight:600;margin-bottom:4px}.arch-node p{font-size:11px;color:var(--text-muted);font-family:var(--font-mono)}
.arch-arrow{font-size:20px;color:var(--text-muted);padding:0 8px}
.process-hero{padding:60px 0 40px;text-align:center}
.process-hero h2{font-size:36px;font-weight:800;letter-spacing:-1.5px;margin-bottom:12px}
.process-hero h2 .highlight{background:linear-gradient(135deg,var(--accent-amber),#ffcc60);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.process-hero p{font-size:15px;color:var(--text-secondary);font-weight:300;max-width:500px;margin:0 auto}
.upload-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(380px,1fr));gap:14px;margin:40px 0}
.upload-card{background:var(--bg-card);border:2px dashed var(--border);border-radius:var(--radius);padding:20px 24px;transition:all .3s}
.upload-card:hover{border-color:var(--border-active);background:var(--bg-card-hover)}
.upload-card.has-file{border-style:solid;border-color:var(--accent-green);background:var(--accent-green-dim)}
.upload-top{display:flex;align-items:center;gap:14px}
.upload-num{font-family:var(--font-mono);font-size:11px;color:var(--text-muted);min-width:22px}
.upload-icon{width:42px;height:42px;border-radius:var(--radius-sm);display:grid;place-items:center;font-size:20px;flex-shrink:0;background:var(--accent-amber-dim);color:var(--accent-amber);transition:all .3s}
.upload-card.has-file .upload-icon{background:var(--accent-green-dim);color:var(--accent-green)}
.upload-info{flex:1;min-width:0}
.upload-info h4{font-size:14px;font-weight:600;margin-bottom:2px}
.upload-info .file-desc{font-size:11px;color:var(--text-muted);font-family:var(--font-mono)}
.upload-info .file-name{font-size:11px;color:var(--accent-green);font-family:var(--font-mono);margin-top:4px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:none}
.upload-card.has-file .file-name{display:block}.upload-card.has-file .file-desc{display:none}
.upload-check{width:26px;height:26px;border-radius:50%;background:var(--accent-green);color:#000;display:none;place-items:center;font-size:13px;font-weight:700;flex-shrink:0}
.upload-card.has-file .upload-check{display:grid}
.upload-actions{display:flex;align-items:center;gap:10px;margin-top:14px;padding-top:14px;border-top:1px solid var(--border);flex-wrap:wrap}
.or-text{font-size:10px;color:var(--text-muted);font-family:var(--font-mono);text-transform:uppercase;letter-spacing:1px}
.upload-browse{position:relative;overflow:hidden}
.upload-browse input[type="file"]{position:absolute;inset:0;opacity:0;cursor:pointer;z-index:2}
.browse-btn{display:inline-flex;align-items:center;gap:6px;padding:7px 14px;border-radius:6px;font-family:var(--font-mono);font-size:11px;background:var(--bg-elevated);color:var(--text-secondary);border:1px solid var(--border);cursor:pointer;transition:all .2s}
.browse-btn:hover{border-color:var(--border-active);color:var(--text-primary)}
.fetch-btn{display:inline-flex;align-items:center;gap:6px;padding:7px 14px;border-radius:6px;font-family:var(--font-display);font-size:12px;font-weight:600;background:linear-gradient(135deg,var(--accent-blue),#4090ea);color:#fff;border:none;cursor:pointer;transition:all .2s}
.fetch-btn:hover{transform:translateY(-1px);box-shadow:0 4px 16px #60a5fa40}
.fetch-btn:disabled{opacity:.5;cursor:not-allowed;transform:none}
.fetch-form{display:none;margin-top:10px;padding:12px;background:var(--bg-elevated);border:1px solid var(--border);border-radius:var(--radius-sm);animation:fadeUp .2s ease}
.fetch-form.active{display:block}
.fetch-form-row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.fetch-form label{font-size:11px;font-family:var(--font-mono);color:var(--text-muted);min-width:30px}
.fetch-form input[type="date"]{padding:6px 10px;border-radius:6px;border:1px solid var(--border);background:var(--bg-card);color:var(--text-primary);font-family:var(--font-mono);font-size:12px;outline:none}
.fetch-form input[type="date"]:focus{border-color:var(--accent-blue)}
.fetch-go{display:inline-flex;align-items:center;gap:5px;padding:6px 16px;border-radius:6px;font-family:var(--font-display);font-size:12px;font-weight:600;background:var(--accent-blue);color:#fff;border:none;cursor:pointer;transition:all .2s}
.fetch-go:hover{background:#4090ea}.fetch-go:disabled{opacity:.5;cursor:not-allowed}
.fetch-status{font-size:11px;font-family:var(--font-mono);margin-top:8px}
.fetch-status.loading{color:var(--accent-blue)}.fetch-status.success{color:var(--accent-green)}.fetch-status.error{color:var(--accent-red)}
.process-actions{text-align:center;margin:40px 0}
.btn-process{display:inline-flex;align-items:center;gap:10px;padding:18px 48px;border-radius:var(--radius);font-family:var(--font-display);font-size:16px;font-weight:700;border:none;cursor:pointer;background:linear-gradient(135deg,var(--accent-amber),#e09520);color:#000;box-shadow:0 4px 24px #f0a83040;transition:all .3s}
.btn-process:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 8px 32px #f0a83060}
.btn-process:disabled{opacity:.4;cursor:not-allowed}.btn-process.processing{background:var(--bg-elevated);color:var(--accent-amber);border:1px solid var(--accent-amber)}
.progress-panel{display:none;margin:0 0 40px;background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius-lg);overflow:hidden}
.progress-panel.active{display:block;animation:fadeUp .4s ease}
.progress-header{display:flex;align-items:center;justify-content:space-between;padding:20px 28px;border-bottom:1px solid var(--border)}
.progress-header h3{font-size:15px;font-weight:600}
.progress-pct{font-family:var(--font-mono);font-size:14px;font-weight:500;color:var(--accent-amber)}
.progress-bar-container{height:4px;background:var(--border)}.progress-bar-fill{height:100%;width:0;border-radius:2px;background:linear-gradient(90deg,var(--accent-amber),#ffcc60);transition:width .4s;box-shadow:0 0 12px #f0a83060}
.progress-logs{padding:20px 28px;max-height:320px;overflow-y:auto;font-family:var(--font-mono);font-size:12px;line-height:2;color:var(--text-secondary)}
.progress-logs::-webkit-scrollbar{width:5px}.progress-logs::-webkit-scrollbar-track{background:transparent}.progress-logs::-webkit-scrollbar-thumb{background:var(--border-active);border-radius:3px}
.log-line{opacity:0;animation:logAppear .3s ease forwards}.log-line.error{color:var(--accent-red)}.log-line.success{color:var(--accent-green)}
.download-panel{display:none;text-align:center;margin:40px 0;padding:48px;background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius-lg)}
.download-panel.active{display:block;animation:fadeUp .5s ease}
.download-panel .dl-icon{width:80px;height:80px;border-radius:50%;background:var(--accent-green-dim);color:var(--accent-green);display:grid;place-items:center;font-size:36px;margin:0 auto 20px;animation:bounceIn .5s ease}
.download-panel h3{font-size:22px;font-weight:700;margin-bottom:8px}
.download-panel p{font-size:14px;color:var(--text-secondary);margin-bottom:28px;font-weight:300}
.btn-download{display:inline-flex;align-items:center;gap:10px;padding:16px 40px;border-radius:var(--radius);font-family:var(--font-display);font-size:15px;font-weight:700;border:none;cursor:pointer;background:linear-gradient(135deg,var(--accent-green),#22b87a);color:#000;box-shadow:0 4px 24px #34d39940;transition:all .3s;text-decoration:none}
.btn-download:hover{transform:translateY(-2px);box-shadow:0 8px 32px #34d39960}
.error-panel{display:none;text-align:center;margin:40px 0;padding:40px;background:var(--bg-card);border:1px solid var(--accent-red);border-radius:var(--radius-lg)}
.error-panel.active{display:block;animation:fadeUp .5s ease}
.error-panel h3{font-size:20px;font-weight:700;color:var(--accent-red);margin-bottom:12px}
.error-panel p{font-size:13px;color:var(--text-secondary);font-family:var(--font-mono);word-break:break-all}
footer{padding:40px 0;border-top:1px solid var(--border);margin-top:60px;display:flex;align-items:center;justify-content:space-between}
footer p{font-size:12px;color:var(--text-muted);font-family:var(--font-mono)}
@keyframes fadeUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
@keyframes fadeDown{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}
@keyframes logAppear{from{opacity:0;transform:translateX(-8px)}to{opacity:1;transform:translateX(0)}}
@keyframes bounceIn{0%{transform:scale(.5);opacity:0}60%{transform:scale(1.1)}100%{transform:scale(1);opacity:1}}
@keyframes spin{to{transform:rotate(360deg)}}
.spinner{display:inline-block;width:14px;height:14px;border:2px solid transparent;border-top-color:currentColor;border-radius:50%;animation:spin .6s linear infinite}
@media(max-width:768px){.container{padding:0 20px}.stats-grid{grid-template-columns:repeat(2,1fr)}.hero h1{font-size:36px}.upload-grid{grid-template-columns:1fr}.arch-flow{flex-direction:column}.arch-arrow{transform:rotate(90deg)}footer{flex-direction:column;gap:16px;text-align:center}.tab-switcher{width:100%}.tab-btn{flex:1;text-align:center;padding:10px 12px;font-size:12px}nav{flex-wrap:wrap;gap:12px}}
</style>
</head>
<body>
<div class="ambient-glow glow-1"></div>
<div class="ambient-glow glow-2"></div>
<div class="container">

<nav>
  <div class="nav-brand">
    <div class="nav-logo">WA</div>
    <div class="nav-title">Market Automation <span>/ v2.0</span></div>
  </div>
  <div class="tab-switcher">
    <button class="tab-btn active" onclick="switchTab('overview')">Overview</button>
    <button class="tab-btn" onclick="switchTab('processing')">‚ö° Processing</button>
  </div>
</nav>

<!-- TAB 1: OVERVIEW -->
<div id="tab-overview" class="tab-content active">
  <section class="hero">
    <div class="hero-badge">‚ö° Logistics Automation Engine</div>
    <h1>Work Assignment<br><span class="highlight">Summary Automation</span></h1>
    <p>7 file inputs. 15+ output sheets. Zone mapping, vendor analytics, hiring breakdowns ‚Äî all processed in seconds.</p>
    <div style="display:flex;gap:14px;justify-content:center;animation:fadeUp .6s ease .4s both;">
      <button class="btn-process" style="padding:14px 28px;font-size:14px;" onclick="switchTab('processing')">‚ö° Start Processing</button>
    </div>
  </section>
  <section class="section">
    <div class="section-label">// Architecture</div>
    <div class="section-title">Data Flow</div>
    <div class="arch-flow">
      <div class="arch-node"><h5>üìÅ 7 Input Files</h5><p>.xlsx / .csv</p></div><div class="arch-arrow">‚Üí</div>
      <div class="arch-node"><h5>üîç VLOOKUP</h5><p>Zone Mapping</p></div><div class="arch-arrow">‚Üí</div>
      <div class="arch-node"><h5>‚öôÔ∏è Filter Engine</h5><p>ERP / APP / FIX</p></div><div class="arch-arrow">‚Üí</div>
      <div class="arch-node"><h5>üìä Analytics</h5><p>COUNTIF / Rates</p></div><div class="arch-arrow">‚Üí</div>
      <div class="arch-node"><h5>üíæ Excel Output</h5><p>15+ Sheets</p></div>
    </div>
  </section>
  <section class="section">
    <div class="section-label">// Metrics</div>
    <div class="section-title">What It Processes</div>
    <div class="stats-grid">
      <div class="stat-card" style="--card-accent:var(--accent-amber)"><div class="stat-label">Input Files</div><div class="stat-value" style="color:var(--accent-amber)">7</div><div class="stat-desc">Branch, Summary, Cancel, Challenge, Staff, Broker, HO</div></div>
      <div class="stat-card" style="--card-accent:var(--accent-green)"><div class="stat-label">Output Sheets</div><div class="stat-value" style="color:var(--accent-green)">15+</div><div class="stat-desc">Summary, ERP, APP, Rates, Vendors & more</div></div>
      <div class="stat-card" style="--card-accent:var(--accent-blue)"><div class="stat-label">Processing</div><div class="stat-value" style="color:var(--accent-blue)">28</div><div class="stat-desc">Automated steps end-to-end</div></div>
      <div class="stat-card" style="--card-accent:var(--accent-purple)"><div class="stat-label">Summary Tables</div><div class="stat-value" style="color:var(--accent-purple)">10</div><div class="stat-desc">Hiring, Load Type, Zone Matrix & more</div></div>
    </div>
  </section>
</div>

<!-- TAB 2: PROCESSING -->
<div id="tab-processing" class="tab-content">
  <section class="process-hero">
    <h2>Upload & <span class="highlight">Process</span></h2>
    <p>Upload manually ya Auto Fetch se OM Insights se seedha download karo.</p>
  </section>

  <div class="upload-grid">

    <!-- 01 BRANCH MASTER ‚Äî Auto Fetch (no dates) -->
    <div class="upload-card" id="card-branch_master">
      <div class="upload-top">
        <div class="upload-num">01</div>
        <div class="upload-icon">üìã</div>
        <div class="upload-info">
          <h4>BRANCH MASTER XL</h4>
          <div class="file-desc">Zone lookup mapping ‚Äî .xlsx / .csv</div>
          <div class="file-name" id="fname-branch_master"></div>
        </div>
        <div class="upload-check">‚úì</div>
      </div>
      <div class="upload-actions">
        <div class="upload-browse"><div class="browse-btn">üìÇ Browse</div><input type="file" accept=".xlsx,.xls,.csv" data-key="branch_master" onchange="handleFile(this)"></div>
        <span class="or-text">or</span>
        <button class="fetch-btn" id="fetchbtn-branch_master" onclick="fetchNoDates('branch_master')">‚ö° Auto Fetch</button>
      </div>
      <div class="fetch-status" id="fetchstatus-branch_master"></div>
    </div>

    <!-- 02 WORK SUMMARY ‚Äî Auto Fetch (date range) -->
    <div class="upload-card" id="card-work_summary">
      <div class="upload-top">
        <div class="upload-num">02</div>
        <div class="upload-icon">üìä</div>
        <div class="upload-info">
          <h4>Work Assign Summary (0016)</h4>
          <div class="file-desc">Main data source ‚Äî .xlsx / .csv</div>
          <div class="file-name" id="fname-work_summary"></div>
        </div>
        <div class="upload-check">‚úì</div>
      </div>
      <div class="upload-actions">
        <div class="upload-browse"><div class="browse-btn">üìÇ Browse</div><input type="file" accept=".xlsx,.xls,.csv" data-key="work_summary" onchange="handleFile(this)"></div>
        <span class="or-text">or</span>
        <button class="fetch-btn" onclick="toggleFetchForm('work_summary')">‚ö° Auto Fetch</button>
      </div>
      <div class="fetch-form" id="fetchform-work_summary">
        <div class="fetch-form-row">
          <label>From</label><input type="date" id="from-work_summary">
          <label>To</label><input type="date" id="to-work_summary">
          <button class="fetch-go" onclick="fetchWithDates('work_summary')">‚ö° Fetch</button>
        </div>
        <div class="fetch-status" id="fetchstatus-work_summary"></div>
      </div>
    </div>

    <!-- 03 CANCEL REPORT ‚Äî Manual only -->
    <div class="upload-card" id="card-cancel_report">
      <div class="upload-top">
        <div class="upload-num">03</div>
        <div class="upload-icon" style="background:var(--accent-red-dim);color:var(--accent-red)">‚ùå</div>
        <div class="upload-info">
          <h4>Cancel Remark Report</h4>
          <div class="file-desc">Cancellation analysis ‚Äî .xlsx / .csv</div>
          <div class="file-name" id="fname-cancel_report"></div>
        </div>
        <div class="upload-check">‚úì</div>
      </div>
      <div class="upload-actions">
        <div class="upload-browse"><div class="browse-btn">üìÇ Browse File</div><input type="file" accept=".xlsx,.xls,.csv" data-key="cancel_report" onchange="handleFile(this)"></div>
      </div>
    </div>

    <!-- 04 CHALLENGE REPORT ‚Äî Manual only -->
    <div class="upload-card" id="card-challenge_report">
      <div class="upload-top">
        <div class="upload-num">04</div>
        <div class="upload-icon" style="background:var(--accent-green-dim);color:var(--accent-green)">üí∞</div>
        <div class="upload-info">
          <h4>Challenge Price Report</h4>
          <div class="file-desc">Bid & savings data ‚Äî .xlsx / .csv</div>
          <div class="file-name" id="fname-challenge_report"></div>
        </div>
        <div class="upload-check">‚úì</div>
      </div>
      <div class="upload-actions">
        <div class="upload-browse"><div class="browse-btn">üìÇ Browse File</div><input type="file" accept=".xlsx,.xls,.csv" data-key="challenge_report" onchange="handleFile(this)"></div>
      </div>
    </div>

    <!-- 05 VEHICLE HIRING ‚Äî Auto Fetch (date range) -->
    <div class="upload-card" id="card-staff_detail">
      <div class="upload-top">
        <div class="upload-num">05</div>
        <div class="upload-icon">üöõ</div>
        <div class="upload-info">
          <h4>Vehicle Hiring Incentive (0003)</h4>
          <div class="file-desc">Staff detail report ‚Äî .xlsx / .csv</div>
          <div class="file-name" id="fname-staff_detail"></div>
        </div>
        <div class="upload-check">‚úì</div>
      </div>
      <div class="upload-actions">
        <div class="upload-browse"><div class="browse-btn">üìÇ Browse</div><input type="file" accept=".xlsx,.xls,.csv" data-key="staff_detail" onchange="handleFile(this)"></div>
        <span class="or-text">or</span>
        <button class="fetch-btn" onclick="toggleFetchForm('staff_detail')">‚ö° Auto Fetch</button>
      </div>
      <div class="fetch-form" id="fetchform-staff_detail">
        <div class="fetch-form-row">
          <label>From</label><input type="date" id="from-staff_detail">
          <label>To</label><input type="date" id="to-staff_detail">
          <button class="fetch-go" onclick="fetchWithDates('staff_detail')">‚ö° Fetch</button>
        </div>
        <div class="fetch-status" id="fetchstatus-staff_detail"></div>
      </div>
    </div>

    <!-- 06 BROKER MASTER ‚Äî Auto Fetch (no dates) -->
    <div class="upload-card" id="card-broker_master">
      <div class="upload-top">
        <div class="upload-num">06</div>
        <div class="upload-icon" style="background:var(--accent-amber-dim);color:var(--accent-amber)">ü§ù</div>
        <div class="upload-info">
          <h4>Broker Master (0005)</h4>
          <div class="file-desc">New vendor registration ‚Äî .xlsx / .csv</div>
          <div class="file-name" id="fname-broker_master"></div>
        </div>
        <div class="upload-check">‚úì</div>
      </div>
      <div class="upload-actions">
        <div class="upload-browse"><div class="browse-btn">üìÇ Browse</div><input type="file" accept=".xlsx,.xls,.csv" data-key="broker_master" onchange="handleFile(this)"></div>
        <span class="or-text">or</span>
        <button class="fetch-btn" id="fetchbtn-broker_master" onclick="fetchNoDates('broker_master')">‚ö° Auto Fetch</button>
      </div>
      <div class="fetch-status" id="fetchstatus-broker_master"></div>
    </div>

    <!-- 07 HO FILE ‚Äî Manual only -->
    <div class="upload-card" id="card-ho_file">
      <div class="upload-top">
        <div class="upload-num">07</div>
        <div class="upload-icon" style="background:var(--accent-blue-dim);color:var(--accent-blue)">üè¢</div>
        <div class="upload-info">
          <h4>HO & Branch Segregation</h4>
          <div class="file-desc">Employee code segregation ‚Äî .xlsx / .csv</div>
          <div class="file-name" id="fname-ho_file"></div>
        </div>
        <div class="upload-check">‚úì</div>
      </div>
      <div class="upload-actions">
        <div class="upload-browse"><div class="browse-btn">üìÇ Browse File</div><input type="file" accept=".xlsx,.xls,.csv" data-key="ho_file" onchange="handleFile(this)"></div>
      </div>
    </div>

  </div>

  <div class="process-actions">
    <button class="btn-process" id="btnProcess" onclick="startProcessing()" disabled>
      <span id="btnIcon">‚ö°</span>
      <span id="btnText">Upload All 7 Files First</span>
    </button>
  </div>

  <div class="progress-panel" id="progressPanel">
    <div class="progress-header"><h3>‚öôÔ∏è Processing...</h3><span class="progress-pct" id="progressPct">0%</span></div>
    <div class="progress-bar-container"><div class="progress-bar-fill" id="progressBar"></div></div>
    <div class="progress-logs" id="progressLogs"></div>
  </div>

  <div class="download-panel" id="downloadPanel">
    <div class="dl-icon">‚úì</div>
    <h3>Processing Complete!</h3>
    <p>WORK_ASSIGN_SUMMARY_PROCESSED.xlsx is ready with 15+ formatted sheets.</p>
    <a class="btn-download" id="downloadLink" href="#"><svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg> Download Excel File</a>
  </div>

  <div class="error-panel" id="errorPanel">
    <h3>‚ùå Processing Failed</h3>
    <p id="errorMsg"></p>
  </div>
</div>

<footer>
  <p>Built with Python + Pandas + Flask + OpenPyXL</p>
  <p>market.py ‚Üí Web App</p>
</footer>
</div>

<script>
function switchTab(t){document.querySelectorAll('.tab-content').forEach(e=>e.classList.remove('active'));document.querySelectorAll('.tab-btn').forEach(e=>e.classList.remove('active'));document.getElementById('tab-'+t).classList.add('active');document.querySelectorAll('.tab-btn')[t==='overview'?0:1].classList.add('active');window.scrollTo({top:0,behavior:'smooth'})}

const uploadedFiles={};
const fetchedFilePaths={};
const requiredKeys=['branch_master','work_summary','cancel_report','challenge_report','staff_detail','broker_master','ho_file'];

function isFileReady(k){return uploadedFiles[k]||fetchedFilePaths[k]}
function markCardDone(k,name){document.getElementById('card-'+k).classList.add('has-file');document.getElementById('fname-'+k).textContent=name;updateProcessButton()}

function handleFile(input){
  const k=input.dataset.key, f=input.files[0];
  if(!f)return;
  uploadedFiles[k]=f;
  delete fetchedFilePaths[k];
  markCardDone(k,f.name);
}

function toggleFetchForm(k){document.getElementById('fetchform-'+k).classList.toggle('active')}

async function fetchWithDates(k){
  const fd=document.getElementById('from-'+k).value;
  const td=document.getElementById('to-'+k).value;
  const st=document.getElementById('fetchstatus-'+k);
  if(!fd||!td){st.className='fetch-status error';st.textContent='‚ùå Select both dates';return}
  st.className='fetch-status loading';st.textContent='‚è≥ Fetching from OM Insights...';
  try{
    const r=await fetch('/api/fetch-report',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({report_key:k,from_date:fd,to_date:td})});
    const d=await r.json();
    if(!r.ok||d.error){st.className='fetch-status error';st.textContent='‚ùå '+d.error;return}
    fetchedFilePaths[k]=d.filepath;delete uploadedFiles[k];
    st.className='fetch-status success';st.textContent='‚úÖ '+d.filename+' ('+d.size_kb+' KB)';
    markCardDone(k,d.filename);
    document.getElementById('fetchform-'+k).classList.remove('active');
  }catch(e){st.className='fetch-status error';st.textContent='‚ùå '+e.message}
}

async function fetchNoDates(k){
  const btn=document.getElementById('fetchbtn-'+k);
  const st=document.getElementById('fetchstatus-'+k);
  btn.disabled=true;btn.innerHTML='<span class="spinner"></span> Fetching...';
  st.className='fetch-status loading';st.textContent='‚è≥ Fetching from OM Insights...';
  try{
    const r=await fetch('/api/fetch-report',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({report_key:k})});
    const d=await r.json();
    if(!r.ok||d.error){st.className='fetch-status error';st.textContent='‚ùå '+d.error;btn.disabled=false;btn.innerHTML='‚ö° Auto Fetch';return}
    fetchedFilePaths[k]=d.filepath;delete uploadedFiles[k];
    st.className='fetch-status success';st.textContent='‚úÖ '+d.filename+' ('+d.size_kb+' KB)';
    markCardDone(k,d.filename);
  }catch(e){st.className='fetch-status error';st.textContent='‚ùå '+e.message}
  btn.disabled=false;btn.innerHTML='‚ö° Auto Fetch';
}

function updateProcessButton(){
  const c=requiredKeys.filter(k=>isFileReady(k)).length;
  const btn=document.getElementById('btnProcess');
  const txt=document.getElementById('btnText');
  if(c===7){btn.disabled=false;txt.textContent='Process All Files'}
  else{btn.disabled=true;txt.textContent=c+'/7 Files Ready'}
}

let currentJobId=null,logIndex=0;

async function startProcessing(){
  const btn=document.getElementById('btnProcess');
  btn.disabled=true;btn.classList.add('processing');
  document.getElementById('btnIcon').innerHTML='<span class="spinner"></span>';
  document.getElementById('btnText').textContent='Processing...';
  document.getElementById('progressPanel').classList.add('active');
  document.getElementById('downloadPanel').classList.remove('active');
  document.getElementById('errorPanel').classList.remove('active');
  document.getElementById('progressLogs').innerHTML='';
  const fd=new FormData();
  for(const k of requiredKeys){
    if(uploadedFiles[k])fd.append(k,uploadedFiles[k]);
    else if(fetchedFilePaths[k])fd.append(k+'_filepath',fetchedFilePaths[k]);
  }
  try{
    const r=await fetch('/api/process',{method:'POST',body:fd});
    const d=await r.json();
    if(!r.ok){showError(d.error||'Upload failed');return}
    currentJobId=d.job_id;logIndex=0;pollStatus();
  }catch(e){showError('Network error: '+e.message)}
}

async function pollStatus(){
  if(!currentJobId)return;
  try{
    const r=await fetch('/api/status/'+currentJobId);const d=await r.json();
    document.getElementById('progressBar').style.width=d.progress+'%';
    document.getElementById('progressPct').textContent=d.progress+'%';
    const l=document.getElementById('progressLogs');
    while(logIndex<d.logs.length){
      const ln=document.createElement('div');ln.className='log-line';
      if(d.logs[logIndex].includes('‚úÖ'))ln.className+=' success';
      if(d.logs[logIndex].includes('‚ùå'))ln.className+=' error';
      ln.textContent=d.logs[logIndex];l.appendChild(ln);logIndex++;l.scrollTop=l.scrollHeight;
    }
    if(d.status==='completed'){document.getElementById('downloadPanel').classList.add('active');document.getElementById('downloadLink').href='/api/download/'+currentJobId;resetButton();return}
    if(d.status==='failed'){showError(d.error||'Unknown error');return}
    setTimeout(pollStatus,600);
  }catch(e){setTimeout(pollStatus,1000)}
}

function showError(m){document.getElementById('errorPanel').classList.add('active');document.getElementById('errorMsg').textContent=m;resetButton()}
function resetButton(){const b=document.getElementById('btnProcess');b.disabled=false;b.classList.remove('processing');document.getElementById('btnIcon').textContent='‚ö°';document.getElementById('btnText').textContent='Process Again';logIndex=0;currentJobId=null}
</script>
</body>
</html>